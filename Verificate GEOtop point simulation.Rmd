---
title: "Verificate GEOtop point simulation"
author: "JBr"
date: "25. Juni 2015"
output: html_document
runtime: shiny
---

***

This R Markdown document is made interactive using Shiny. To learn more, see [Interactive Documents](http://rmarkdown.rstudio.com/authoring_shiny.html).

***

```{r, include=FALSE}


if(!require(AnalyseGeotop))
{
  if(!require(devtools))
  {
    install.packages(devtools)
    require(devtools)
  }
  install_github("AnalyseGeotop", "JBrenn")
  require(AnalyseGeotop)
}

if(!require(dygraphs))
{
  install.packages(dygraphs)
  require(dygraphs)
}

if(!require(hydroGOF))
{
  install.packages(hydroGOF)
  require(hydroGOF)
}

data("PointOutValidation_sim0011_1D_HiResAlp")
data("observations_B2")

obs <- list(hour=B2_h, day=B2_d)

```

## Inputs and Output

```{r, echo=FALSE}
inputPanel(
  #textInput(inputId = "simFolder", label = "Simulation folder", value = "")
  
  selectInput(inputId = "variable", label = "discover variable", choices = names(B2_d)),
  
  radioButtons(inputId = "aggregation", label = "aggregation", choices = c("hour","day"), selected = "day", inline = FALSE),
  
  radioButtons(inputId = "flux_amount", label = "flux or amount", choices = c("flux","amount"), selected = "flux", inline = FALSE),
  
  submitButton(text = "apply changes")
  
)

```

***

```{r, echo=FALSE}

renderDygraph({
  observation <- obs[[input$aggregation]][,input$variable]
  
  simulation <- var_out[[input$variable]]
  
  if (input$aggregation=="day" & input$flux_amount=="flux") simulation <- aggregate(simulation, as.Date(time(simulation)), mean) 
  if (input$aggregation=="day" & input$flux_amount=="amount") simulation <- aggregate(simulation, as.Date(time(simulation)), sum)
  
  data <- merge(observation, simulation)
  
  dygraph(data) %>%
    dyRangeSelector() %>%
    dyRoller()
    
})

```

***

```{r, echo=FALSE}

renderDataTable({
  observation <- obs[[input$aggregation]][,input$variable]
  
  simulation <- var_out[[input$variable]]
  
  if (input$aggregation=="day" & input$flux_amount=="flux") simulation <- aggregate(simulation, as.Date(time(simulation)), mean) 
  if (input$aggregation=="day" & input$flux_amount=="amount") simulation <- aggregate(simulation, as.Date(time(simulation)), sum)
  
  data <- merge(observation, simulation)
  
  gofs <- gof(sim = data$simulation, obs=data$observation, na.rm = T)
  gofs <- as.data.frame(gofs)
  names(gofs) <- "VALUE"
  gofs$GOF <- dimnames(gofs)[[1]]
  gofs <- gofs[,c(2,1)]
})

```
